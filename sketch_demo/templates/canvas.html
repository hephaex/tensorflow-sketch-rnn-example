<!doctype html>
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html; charset=utf-8">
    <title>Sketch Kids</title>
    <link rel='shortcut icon' href='favicon.ico'/>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
  </head>
  <body>

  <h1>Sketch Kids (Sketch-RNN demo)</h1>
  <table>
    <td style="border-style: none;">
      <div style="border: solid 2px #666; width: 304px; height: 204px;">
        <canvas id="canvas" width="300" height="200"></canvas>
      </div>
    </td>
    <td style="border-style: none;">
      <button onclick="clear_value()">Clear</button>
      <button onclick="send_strokes()">Submit</button>
    </td>
  </table>

  <p>
  <table border="1" width="600"><tr><td>Your Sample</td></tr>
    <tr><td align="center"><img id="original" width="120" src="{{url_for('static', filename='cat.png')}}"></td></tr>
    <tr><td>Kid1(Young)</td>
    <td>Kid2(Younger)</td>
    <td>Kid3(Youngest)</td></tr>
    <tr>
    <td align="center"><img id="kid1" width="120" src="{{url_for('static', filename='white.png')}}"></td>
    <td align="center"><img id="kid2" width="120" src="{{url_for('static', filename='white.png')}}"></td>
    <td align="center"><img id="kid3" width="120" src="{{url_for('static', filename='white.png')}}"></td>
    </tr>
  </table>
  <p>
  <div>
    Note: These kids really love cats and buses! They would never draw other things.
  </div>

  <script langukid="javascript" type="text/javascript">
    var pen_down = 0;
    var pre_x = 0, pre_y = 0;
    var strokes = [];

    var canvas = document.getElementById("canvas");
    canvas.addEventListener("mousemove", function(e){       
        if (e.buttons == 1) {
          var ctx = canvas.getContext("2d");
          if (pen_down == 0) {
            strokes.push(e.offsetX, e.offsetY, 0);
            pen_down = 1;
          } else {
            strokes.push(e.offsetX, e.offsetY, 1);                
            ctx.fillStyle = "rgb(0,0,0)";
            var dx = e.offsetX - pre_x
            var dy = e.offsetY - pre_y
            var dist = parseInt(Math.sqrt(dx * dx + dy * dy))
	    for (i = 0.1; i < 1.1; i = i + 0.1){
              ctx.fillRect(pre_x + dx * i, pre_y + dy * i, 5, 5);
	    }
          }
          pre_x = e.offsetX;
          pre_y = e.offsetY;
          pen_down = 1;
        } else {
          pen_down = 0;
        }
    });

    function clear_value(){
      var ctx = canvas.getContext("2d");
      ctx.fillStyle = "rgb(255,255,255)";
      ctx.fillRect(0, 0, 400, 300);
      ctx.beginPath();
      strokes = [];
    }

    function send_strokes() {
        $.ajax({
          type: 'POST',
          url: 'post',
          data: JSON.stringify(strokes),
          success: function(response) {
	         var target0 = document.getElementById("original");
	         var target1 = document.getElementById("kid1");
	         var target2 = document.getElementById("kid2");
	         var target3 = document.getElementById("kid3");
	         target0.src = response.original;
	         target1.src = response.kid1;
	         target2.src = response.kid2;
	         target3.src = response.kid3; },
	  contentType: "application/json",
	  dataType: 'json'
        });
    }
  </script>
  </body>
</html>
